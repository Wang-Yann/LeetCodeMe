-- @Author        : Rock Wayne
-- @Created       : 2020-07-30 22:31:51
-- @Last Modified : 2020-07-30 22:31:51
--
-- #å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå°† 2016 å¹´ (TIV_2016) æ‰€æœ‰æˆåŠŸæŠ•èµ„çš„é‡‘é¢åŠ èµ·æ¥ï¼Œä¿ç•™ 2 ä½å°æ•°ã€‚
-- #
-- # å¯¹äºŽä¸€ä¸ªæŠ•ä¿äººï¼Œä»–åœ¨ 2016 å¹´æˆåŠŸæŠ•èµ„çš„æ¡ä»¶æ˜¯ï¼š
-- #
-- #
-- # ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é¢ (TIV_2015) è‡³å°‘è·Ÿä¸€ä¸ªå…¶ä»–æŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é¢ç›¸åŒã€‚
-- # ä»–æ‰€åœ¨çš„åŸŽå¸‚å¿…é¡»ä¸Žå…¶ä»–æŠ•ä¿äººéƒ½ä¸åŒï¼ˆä¹Ÿå°±æ˜¯è¯´ç»´åº¦å’Œç»åº¦ä¸èƒ½è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªæŠ•ä¿äººå®Œå…¨ç›¸åŒï¼‰ã€‚
-- #
-- #
-- # è¾“å…¥æ ¼å¼:
-- #è¡¨ insurance æ ¼å¼å¦‚ä¸‹ï¼š
-- #
-- # | Column Name | Type          |
-- #|-------------|---------------|
-- #| PID         | INTEGER(11)   |
-- #| TIV_2015    | NUMERIC(15,2) |
-- #| TIV_2016    | NUMERIC(15,2) |
-- #| LAT         | NUMERIC(5,2)  |
-- #| LON         | NUMERIC(5,2)  |
-- #
-- #
-- # PID å­—æ®µæ˜¯æŠ•ä¿äººçš„æŠ•ä¿ç¼–å·ï¼Œ TIV_2015 æ˜¯è¯¥æŠ•ä¿äººåœ¨2015å¹´çš„æ€»æŠ•ä¿é‡‘é¢ï¼Œ TIV_2016 æ˜¯è¯¥æŠ•ä¿äººåœ¨2016å¹´çš„æŠ•ä¿é‡‘é¢ï¼Œ LAT æ˜¯æŠ•
-- #ä¿äººæ‰€åœ¨åŸŽå¸‚çš„ç»´åº¦ï¼Œ LON æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸŽå¸‚çš„ç»åº¦ã€‚
-- #
-- # æ ·ä¾‹è¾“å…¥
-- #
-- # | PID | TIV_2015 | TIV_2016 | LAT | LON |
-- #|-----|----------|----------|-----|-----|
-- #| 1   | 10       | 5        | 10  | 10  |
-- #| 2   | 20       | 20       | 20  | 20  |
-- #| 3   | 10       | 30       | 20  | 20  |
-- #| 4   | 10       | 40       | 40  | 40  |
-- #
-- #
-- # æ ·ä¾‹è¾“å‡º
-- #
-- # | TIV_2016 |
-- #|----------|
-- #| 45.00    |
-- #
-- #
-- # è§£é‡Š
-- #
-- # å°±å¦‚æœ€åŽä¸€ä¸ªæŠ•ä¿äººï¼Œç¬¬ä¸€ä¸ªæŠ•ä¿äººåŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
-- #1. ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é‡‘é¢ TIV_2015 ä¸º '10' ï¼Œä¸Žç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªæŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é‡‘é¢ç›¸åŒã€‚
-- #2. ä»–æ‰€åœ¨åŸŽå¸‚çš„ç»çº¬åº¦æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚
-- #
-- #ç¬¬äºŒä¸ªæŠ•ä¿äººä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ã€‚ä»–åœ¨ 2015 å¹´çš„æŠ•èµ„ TIV_2015 ä¸Žå…¶ä»–ä»»ä½•æŠ•ä¿äººéƒ½ä¸ç›¸åŒã€‚
-- #ä¸”ä»–æ‰€åœ¨åŸŽå¸‚çš„ç»çº¬åº¦ä¸Žç¬¬ä¸‰ä¸ªæŠ•ä¿äººç›¸åŒã€‚åŸºäºŽåŒæ ·çš„åŽŸå› ï¼Œç¬¬ä¸‰ä¸ªæŠ•ä¿äººæŠ•èµ„å¤±è´¥ã€‚
-- #
-- #æ‰€ä»¥è¿”å›žçš„ç»“æžœæ˜¯ç¬¬ä¸€ä¸ªæŠ•ä¿äººå’Œæœ€åŽä¸€ä¸ªæŠ•ä¿äººçš„ TIV_2016 ä¹‹å’Œï¼Œç»“æžœæ˜¯ 45 ã€‚
-- # ðŸ‘ 14 ðŸ‘Ž 0
--
--
--
-- #leetcode submit region begin(Prohibit modification and deletion)
-- # Write your MySQL query statement below


SELECT
    ROUND(SUM(TIV_2016), 2) as TIV_2016
FROM(
        SELECT
            TIV_2016,
            count(*) over(partition by TIV_2015) as cnt_1,
            count(*) over(partition by LAT, LON) as cnt_2
        FROM
            insurance
    ) a
WHERE a.cnt_1 > 1 AND a.cnt_2 =1;

-- #leetcode submit region end(Prohibit modification and deletion)

select sum(A.TIV_2016) as TIV_2016
from insurance as A
where exists(
        select *
        from insurance as B
        where B.PID != A.PID
          and B.TIV_2015 = A.TIV_2015
    )
  and not exists(
        select 1
        from insurance as C
        where C.PID != A.PID
          and C.LON = A.LON
          and C.LAT = A.LAT
    );
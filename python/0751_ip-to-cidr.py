#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author        : Rock Wayne 
# @Created       : 2020-07-31 15:05:25
# @Last Modified : 2020-07-31 15:05:25
# @Mail          : lostlorder@gmail.com
# @Version       : alpha-1.0

"""
# ç»™å®šä¸€ä¸ªèµ·å§‹ IP åœ°å€ ip å’Œä¸€ä¸ªæˆ‘ä»¬éœ€è¦åŒ…å«çš„ IP çš„æ•°é‡ nï¼Œè¿”å›ç”¨åˆ—è¡¨ï¼ˆæœ€å°å¯èƒ½çš„é•¿åº¦ï¼‰è¡¨ç¤ºçš„ CIDRå—çš„èŒƒå›´ã€‚ 
# 
#  CIDR å—æ˜¯åŒ…å« IP çš„å­—ç¬¦ä¸²ï¼Œåæ¥æ–œæ å’Œå›ºå®šé•¿åº¦ã€‚ä¾‹å¦‚ï¼šâ€œ123.45.67.89/20â€ã€‚å›ºå®šé•¿åº¦ â€œ20â€ è¡¨ç¤ºåœ¨ç‰¹å®šçš„èŒƒå›´ä¸­å…¬å…±å‰ç¼€ä½çš„é•¿åº¦ã€‚
#  
# 
#  ç¤ºä¾‹ 1ï¼š 
# 
#  è¾“å…¥ï¼šip = "255.0.0.7", n = 10
# è¾“å‡ºï¼š["255.0.0.7/32","255.0.0.8/29","255.0.0.16/32"]
# è§£é‡Šï¼š
# è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ—¶ï¼Œåˆå§‹IPåœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºæ¸…æ™°èµ·è§æ·»åŠ äº†ç©ºæ ¼ï¼‰ï¼š
# 255.0.0.7 -> 11111111 00000000 00000000 00000111
# åœ°å€ "255.0.0.7/32" è¡¨ç¤ºä¸ç»™å®šåœ°å€æœ‰ç›¸åŒçš„ 32 ä½å‰ç¼€çš„æ‰€æœ‰åœ°å€ï¼Œ
# åœ¨è¿™é‡Œåªæœ‰è¿™ä¸€ä¸ªåœ°å€ã€‚
# 
# åœ°å€ "255.0.0.8/29" è¡¨ç¤ºä¸ç»™å®šåœ°å€æœ‰ç›¸åŒçš„ 29 ä½å‰ç¼€çš„æ‰€æœ‰åœ°å€ï¼š
# 255.0.0.8 -> 11111111 00000000 00000000 00001000
# æœ‰ç›¸åŒçš„ 29 ä½å‰ç¼€çš„åœ°å€å¦‚ä¸‹ï¼š
# 11111111 00000000 00000000 00001000
# 11111111 00000000 00000000 00001001
# 11111111 00000000 00000000 00001010
# 11111111 00000000 00000000 00001011
# 11111111 00000000 00000000 00001100
# 11111111 00000000 00000000 00001101
# 11111111 00000000 00000000 00001110
# 11111111 00000000 00000000 00001111
# 
# åœ°å€ "255.0.0.16/32" è¡¨ç¤ºä¸ç»™å®šåœ°å€æœ‰ç›¸åŒçš„ 32 ä½å‰ç¼€çš„æ‰€æœ‰åœ°å€ï¼Œ
# è¿™é‡Œåªæœ‰ 11111111 00000000 00000000 00010000ã€‚
# 
# æ€»ä¹‹ï¼Œç­”æ¡ˆæŒ‡å®šäº†ä» 255.0.0.7 å¼€å§‹çš„ 10 ä¸ª IP çš„èŒƒå›´ã€‚
# 
# æœ‰ä¸€äº›å…¶ä»–çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
# ["255.0.0.7/32","255.0.0.8/30", "255.0.0.12/30", "255.0.0.16/32"],
# ä½†æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆæ˜¯æœ€çŸ­å¯èƒ½çš„ç­”æ¡ˆã€‚
# 
# å¦å¤–è¯·æ³¨æ„ä»¥ "255.0.0.7/30" å¼€å§‹çš„è¡¨ç¤ºä¸æ­£ç¡®ï¼Œ
# å› ä¸ºå…¶åŒ…æ‹¬äº† 255.0.0.4 = 11111111 00000000 00000000 00000100 è¿™æ ·çš„åœ°å€ï¼Œ
# è¶…å‡ºäº†éœ€è¦è¡¨ç¤ºçš„èŒƒå›´ã€‚
#  
# 
#  
# 
#  æ³¨ï¼š 
# 
#  
#  ip æ˜¯æœ‰æ•ˆçš„ IPv4 åœ°å€ã€‚ 
#  æ¯ä¸€ä¸ªéšå«åœ°å€ ip + x (å…¶ä¸­ x < n) éƒ½æ˜¯æœ‰æ•ˆçš„ IPv4 åœ°å€ã€‚ 
#  n ä¸ºæ•´æ•°ï¼ŒèŒƒå›´ä¸º [1, 1000]ã€‚ 
#  
# 
#  
#  Related Topics ä½è¿ç®— 
#  ğŸ‘ 10 ğŸ‘ 0

"""
from typing import List

import pytest


# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def ipToCIDR(self, ip: str, n: int) -> List[str]:
        """
        Medium
        GOOD TODO
        """

        def ipToInt(ip):
            res = 0
            for x in ip.split("."):
                res = 256 * res + int(x)
            return res

        def intToIp(x):
            return ".".join(str((x >> i) & 255) for i in (24, 16, 8, 0))

        ans = []
        if ip == "0.0.0.0":
            ip = "0.0.0.1"
            n -= 1
            ans = ['0.0.0.0/32']
        start = ipToInt(ip)
        # print(start)
        # æ–¹å¼1
        while n > 0:
            step = start & -start
            while step > n:
                step //= 2
            ans.append(intToIp(start) + "/" + str(33 - step.bit_length()))
            start += step
            n -= step
        # æ–¹å¼2
        # while n:
        #     # æˆ‘ä»¬ä½¿ç”¨ n å’Œ start&-startï¼ˆstart çš„æœ€ä½ä½ï¼‰çš„ä½é•¿åº¦æ¥è®¡ç®—èƒ½è¡¨ç¤º 2**(32-mask)ä¸ª ip åœ°å€çš„æ©ç 
        #     # bin(12&(-12))==bin(12&~(12-1)) = '0b100'
        #     mask = 33 - min(n.bit_length(), (start & ~(start - 1)).bit_length())
        #     ans.append(intToIp(start) + "/" + str(mask))
        #     start += 1 << (32 - mask)
        #     n -= 1 << (32 - mask)
        return ans


# leetcode submit region end(Prohibit modification and deletion)


@pytest.mark.parametrize("kw,expected", [
    [dict(ip="255.0.0.7", n=10), ["255.0.0.7/32", "255.0.0.8/29", "255.0.0.16/32"]],
    [dict(ip="0.0.0.0", n=1), ["0.0.0.0/32"]],
])
def test_solutions(kw, expected):
    assert Solution().ipToCIDR(**kw) == expected


if __name__ == '__main__':
    pytest.main(["-q", "--color=yes", "--capture=no", __file__])
